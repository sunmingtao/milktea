DROP TABLE T_CUSTOMER IF EXISTS;

CREATE TABLE T_CUSTOMER 
(
 ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 CUSTOMER_ID VARCHAR(15) NOT NULL UNIQUE, 
 PASSWORD VARCHAR(20),
 USER_ID VARCHAR(255), 
 CHANNEL_ID VARCHAR(255)
);

DROP TABLE T_SHOP IF EXISTS;

CREATE TABLE T_SHOP 
(
 ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 SHOP_ID VARCHAR(15) NOT NULL UNIQUE,
 SHOP_NAME VARCHAR(255) NOT NULL UNIQUE, 
 PASSWORD VARCHAR(20) NOT NULL,
 NUM_CUP_REDEEM INTEGER,
 AMOUNT_REDEEM NUMERIC (8,2)
);

DROP TABLE T_MOBILE_AUTH IF EXISTS;

CREATE TABLE T_MOBILE_AUTH
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 MOBILE VARCHAR(14) NOT NULL,
 AUTH_CODE VARCHAR(10) NOT NULL,
 USER_TYPE VARCHAR(10) NOT NULL,
 CREATED_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

DROP TABLE T_TRANSACTION_DETAIL IF EXISTS;

CREATE TABLE T_TRANSACTION_DETAIL
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 SHOP_ID VARCHAR(14) NOT NULL,
 CUSTOMER_ID VARCHAR(14) NOT NULL,
 NUM_OF_CUPS INTEGER,
 AMOUNT NUMERIC (8,2),
 TRANSATION_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

ALTER TABLE T_TRANSACTION_DETAIL ADD FOREIGN KEY (SHOP_ID) REFERENCES T_SHOP (SHOP_ID);

DROP TABLE T_TRANSACTION_SUMMARY IF EXISTS;

CREATE TABLE T_TRANSACTION_SUMMARY
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 SHOP_ID VARCHAR(14) NOT NULL,
 CUSTOMER_ID VARCHAR(14) NOT NULL,
 TOTAL_CUPS INTEGER,
 TOTAL_AMOUNT NUMERIC (8,2),
 TOTAL_CUPS_REDEEMED INTEGER,
 TOTAL_AMOUNT_REDEEMED NUMERIC (8,2)
);

ALTER TABLE T_TRANSACTION_SUMMARY ADD FOREIGN KEY (SHOP_ID) REFERENCES T_SHOP (SHOP_ID);
ALTER TABLE T_TRANSACTION_SUMMARY ADD UNIQUE (SHOP_ID, CUSTOMER_ID);

DROP TABLE T_PUSH_NOTIFICATION IF EXISTS;

CREATE TABLE T_PUSH_NOTIFICATION 
(
 ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1) PRIMARY KEY,
 SHOP_ID VARCHAR(14) NOT NULL,
 USER_ID VARCHAR(255), 
 CHANNEL_ID VARCHAR(255),
 MESSAGE VARCHAR(4000) NOT NULL,
 STATUS VARCHAR(20) DEFAULT 'READY' NOT NULL,
 CREATED_TIME TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

ALTER TABLE T_PUSH_NOTIFICATION ADD FOREIGN KEY (SHOP_ID) REFERENCES T_SHOP (SHOP_ID);